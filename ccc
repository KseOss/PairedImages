<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="ClockApp.TimerPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="Таймер">
    <StackLayout Padding="20">
        <TimePicker x:Name="timePicker" Format="HH:mm"/>
        <Button x:Name="btnStart" Text="Старт" Clicked="btnStart_Clicked"/>
        <Label x:Name="lbTime" FontSize="28" HorizontalOptions="Center"/>
    </StackLayout>
</ContentPage>

namespace ClockApp;

public partial class TimerPage : ContentPage
{
    TimeSpan _time;
    IDispatcherTimer _timer;

    public TimerPage()
    {
        InitializeComponent();
    }

    void btnStart_Clicked(object sender, EventArgs e)
    {
        _time = timePicker.Time;
        
        _timer = Application.Current.Dispatcher.CreateTimer();
        _timer.Interval = TimeSpan.FromSeconds(1);
        _timer.Tick += Timer_Tick;
        _timer.Start();
    }

    async void Timer_Tick(object sender, EventArgs e)
    {
        _time = _time.Add(new TimeSpan(0, 0, -1));
        lbTime.Text = _time.ToString(@"hh\:mm\:ss");

        if (_time.CompareTo(new TimeSpan(0, 0, 0)) <= 0)
        {
            DisplayAlert("Внимание", "Время вышло", "ОК");
            
            // Пуш-уведомление
            var request = new NotificationRequest
            {
                NotificationId = 1002,
                Title = "Таймер",
                Description = "Время вышло",
                Schedule = new NotificationRequestSchedule
                {
                    NotifyTime = DateTime.Now
                }
            };
            await LocalNotificationCenter.Current.Show(request);
            
            _timer.Stop();
            lbTime.Text = "";
            timePicker.Time = new TimeSpan(0, 0, 0);
        }
    }
}